<!DOCTYPE html>
<html>
<head>
    <title>Sliding Puzzle Solver</title>
    <style>
        .puzzle-container {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-gap: 5px;
            margin: 20px;
        }
        .tile {
            width: 100px;
            height: 100px;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background-color: #f0f0f0;
            cursor: pointer;
        }
        .empty {
            background-color: #ccc;
        }
        .controls {
            margin: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 5px;
        }
        #result {
            margin: 20px;
            padding: 10px;
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <h1>Sliding Puzzle Solver</h1>
    
    <div class="puzzle-container" id="puzzle">
        <!-- Tiles will be generated by JavaScript -->
    </div>
    
    <div class="controls">
        <button onclick="getPrediction()">Get Best Move</button>
        <button onclick="resetPuzzle()">Reset Puzzle</button>
        <button onclick="shufflePuzzle()">Shuffle</button>
    </div>
    
    <div id="result"></div>

    <script>
        let puzzleState = [1, 2, 3, 4, 5, 6, 7, 0, 8];
        let emptyIndex = 7;

        function renderPuzzle() {
            const container = document.getElementById('puzzle');
            container.innerHTML = '';
            
            puzzleState.forEach((value, index) => {
                const tile = document.createElement('div');
                tile.className = `tile ${value === 0 ? 'empty' : ''}`;
                tile.textContent = value === 0 ? '' : value;
                tile.onclick = () => moveTile(index);
                container.appendChild(tile);
            });
        }

        function moveTile(index) {
            const row = Math.floor(index / 3);
            const col = index % 3;
            const emptyRow = Math.floor(emptyIndex / 3);
            const emptyCol = emptyIndex % 3;
            
            // Check if move is valid (adjacent to empty)
            if ((Math.abs(row - emptyRow) === 1 && col === emptyCol) || 
                (Math.abs(col - emptyCol) === 1 && row === emptyRow)) {
                
                // Swap tiles
                [puzzleState[index], puzzleState[emptyIndex]] = [puzzleState[emptyIndex], puzzleState[index]];
                emptyIndex = index;
                renderPuzzle();
            }
        }

        async function getPrediction() {
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ puzzle: puzzleState })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('result').innerHTML = `
                        <h3>Prediction Result:</h3>
                        <p><strong>Best Move:</strong> ${result.predicted_move}</p>
                        <p><strong>Probabilities:</strong></p>
                        <ul>
                            <li>Up: ${(result.probabilities.up * 100).toFixed(2)}%</li>
                            <li>Down: ${(result.probabilities.down * 100).toFixed(2)}%</li>
                            <li>Left: ${(result.probabilities.left * 100).toFixed(2)}%</li>
                            <li>Right: ${(result.probabilities.right * 100).toFixed(2)}%</li>
                        </ul>
                    `;
                } else {
                    document.getElementById('result').innerHTML = `<p style="color: red;">Error: ${result.error}</p>`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }

        function resetPuzzle() {
            puzzleState = [1, 2, 3, 4, 5, 6, 7, 0, 8];
            emptyIndex = 7;
            renderPuzzle();
            document.getElementById('result').innerHTML = '';
        }

        function shufflePuzzle() {
            // Simple shuffle - in practice, you'd want to ensure the puzzle remains solvable
            for (let i = puzzleState.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [puzzleState[i], puzzleState[j]] = [puzzleState[j], puzzleState[i]];
            }
            emptyIndex = puzzleState.indexOf(0);
            renderPuzzle();
            document.getElementById('result').innerHTML = '';
        }

        // Initialize
        renderPuzzle();
    </script>
</body>
</html>